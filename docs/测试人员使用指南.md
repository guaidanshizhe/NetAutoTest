# 测试人员使用指南

## 概述

本指南面向测试人员，介绍如何使用ADN自动化测试框架进行测试用例开发和执行。

## 快速开始

### 1. 环境准备
确保已安装Python 3.7+和相关依赖：
```bash
pip install -r requirements.txt
```

### 2. 了解框架结构
```
NetAutoTest/
├── framework/          # 框架核心（无需修改）
├── actions/           # AW实现（开发人员维护）
├── testcases/         # 测试用例（测试人员编写）
├── config/            # 配置文件
└── docs/              # 文档
```

### 3. 查看可用AW
运行以下命令查看所有可用的AW：
```python
from framework.aw_manager import aw_manager
print(aw_manager.get_aw_list())
```

## 创建测试用例

### 1. 复制模板文件
```bash
copy testcases\TC_TEMPLATE.py testcases\TC_YOUR_CASE.py
```

### 2. 填写用例信息
```python
class TC_ADN_001(BaseTest):
    # 必须填写的用例信息
    case_id = "TC_ADN_001"                    # 用例唯一标识
    case_name = "ADN服务器连通性测试"           # 用例名称
    author = "张三"                           # 你的姓名
    create_date = "2024-01-15"               # 今天的日期
    description = "验证ADN服务器的网络连通性"   # 详细描述
```

### 3. 编写测试步骤

#### setup方法 - 测试前准备
```python
def setup(self):
    """测试前准备"""
    # 设置测试参数
    self.server_ip = "192.168.1.100"
    
    # 初始化测试环境
    self.call_aw("清理测试环境")
    self.call_aw("准备测试数据")
```

#### 测试主体方法
```python
def test_TC_ADN_001(self):
    """测试用例主体"""
    # 步骤1：执行测试动作
    result = self.call_aw("检查服务器连通性", server_ip=self.server_ip)
    
    # 步骤2：验证结果
    self.verify(result, "服务器连通性检查失败")
```

#### teardown方法 - 测试后清理
```python
def teardown(self):
    """测试后清理"""
    # 清理测试数据
    self.call_aw("清理测试数据")
    
    # 恢复环境
    self.call_aw("恢复初始状态")
```

## AW使用方法

### 1. 基本调用语法
```python
result = self.call_aw("AW名称", 参数名1=参数值1, 参数名2=参数值2)
```

### 2. 常用网络AW示例

#### 检查服务器连通性
```python
# 检查默认SSH端口
result = self.call_aw("检查服务器连通性", server_ip="192.168.1.100")

# 检查指定端口
result = self.call_aw("检查服务器连通性", 
                     server_ip="192.168.1.100", 
                     port=8080, 
                     timeout=10)
```

#### Ping服务器
```python
# 默认ping 4次
result = self.call_aw("ping服务器", server_ip="192.168.1.100")

# 指定ping次数
result = self.call_aw("ping服务器", server_ip="192.168.1.100", count=10)
```

#### 检查HTTP服务
```python
# 检查HTTP服务
result = self.call_aw("检查HTTP服务", url="http://192.168.1.100:8080")

# 检查并验证状态码
result = self.call_aw("检查HTTP服务", 
                     url="http://192.168.1.100:8080/api/health",
                     expected_status=200)
```

#### 检查端口开放
```python
# 检查端口是否开放
result = self.call_aw("检查端口开放", server_ip="192.168.1.100", port=3306)
```

## 结果验证方法

### 1. 基础验证方法

#### verify - 布尔验证
```python
result = self.call_aw("ping服务器", server_ip="192.168.1.100")
self.verify(result["success"], "服务器ping失败")
```

#### verify_equal - 相等验证
```python
result = self.call_aw("检查HTTP服务", url="http://example.com")
self.verify_equal(result["status_code"], 200, "HTTP状态码不正确")
```

#### verify_contains - 包含验证
```python
result = self.call_aw("获取系统信息")
self.verify_contains(result["data"], "cpu_usage", "缺少CPU使用率信息")
```

### 2. 复杂验证示例
```python
def test_complex_verification(self):
    # 获取服务状态
    result = self.call_aw("检查服务状态", service_name="nginx")
    
    # 验证服务运行状态
    self.verify(result["success"], "获取服务状态失败")
    self.verify_equal(result["status"], "running", "服务未运行")
    self.verify(result["cpu_usage"] < 80, "CPU使用率过高")
    self.verify(result["memory_usage"] < 1024, "内存使用过多")
```

## 实际用例示例

### 示例1：简单连通性测试
```python
class TC_NETWORK_001(BaseTest):
    case_id = "TC_NETWORK_001"
    case_name = "基础网络连通性测试"
    author = "测试工程师"
    create_date = "2024-01-15"
    description = "验证目标服务器的基础网络连通性"
    
    def setup(self):
        self.target_server = "192.168.1.100"
    
    def test_TC_NETWORK_001(self):
        # 测试ping连通性
        ping_result = self.call_aw("ping服务器", server_ip=self.target_server)
        self.verify(ping_result["success"], "服务器ping不通")
        
        # 测试SSH端口
        ssh_result = self.call_aw("检查端口开放", 
                                 server_ip=self.target_server, 
                                 port=22)
        self.verify(ssh_result, "SSH端口未开放")
    
    def teardown(self):
        self.logger.info("网络连通性测试完成")
```

### 示例2：Web服务测试
```python
class TC_WEB_001(BaseTest):
    case_id = "TC_WEB_001"
    case_name = "Web服务可用性测试"
    author = "测试工程师"
    create_date = "2024-01-15"
    description = "验证Web服务的可用性和响应性能"
    
    def setup(self):
        self.web_url = "http://192.168.1.100:8080"
        self.health_url = f"{self.web_url}/health"
    
    def test_TC_WEB_001(self):
        # 检查Web服务可用性
        web_result = self.call_aw("检查HTTP服务", url=self.web_url)
        self.verify(web_result["success"], "Web服务不可用")
        self.verify_equal(web_result["status_code"], 200, "HTTP状态异常")
        
        # 检查健康检查接口
        health_result = self.call_aw("检查HTTP服务", url=self.health_url)
        self.verify(health_result["success"], "健康检查接口异常")
        
        # 验证响应时间
        self.verify(health_result["response_time"] < 2.0, "响应时间过长")
    
    def teardown(self):
        self.logger.info("Web服务测试完成")
```

### 示例3：数据驱动测试
```python
class TC_LOGIN_001(BaseTest):
    case_id = "TC_LOGIN_001"
    case_name = "用户登录功能测试"
    author = "测试工程师"
    create_date = "2024-01-15"
    description = "测试不同用户的登录功能"
    
    def setup(self):
        self.login_url = "http://192.168.1.100:8080/login"
        # 准备测试数据
        self.test_users = [
            {"username": "admin", "password": "admin123", "expected": True},
            {"username": "user1", "password": "user123", "expected": True},
            {"username": "invalid", "password": "wrong", "expected": False}
        ]
    
    def test_TC_LOGIN_001(self):
        for user_data in self.test_users:
            with self.subTest(username=user_data["username"]):
                # 执行登录测试
                result = self.call_aw("用户登录",
                                    url=self.login_url,
                                    username=user_data["username"],
                                    password=user_data["password"])
                
                # 验证登录结果
                self.verify_equal(result["success"], 
                                user_data["expected"],
                                f"用户{user_data['username']}登录结果不符合预期")
    
    def teardown(self):
        # 清理登录会话
        self.call_aw("清理用户会话")
```

## 运行测试用例

### 1. 单个用例执行
```bash
# 直接运行Python文件
python testcases\TC_ADN_001.py

# 使用测试执行器
python run_tests.py -f testcases\TC_ADN_001.py
```

### 2. 批量执行
```bash
# 执行所有用例
python run_tests.py

# 执行特定模式的用例
python run_tests.py -p "TC_ADN_*.py"

# 执行特定模块的用例
python run_tests.py -p "TC_NETWORK_*.py"
```

### 3. 查看用例列表
```bash
python run_tests.py -l
```

## 调试和问题排查

### 1. 查看日志
测试执行时会自动生成日志文件在 `logs/` 目录：
```bash
# 查看最新日志
type logs\test.log

# 查看特定日期日志
type logs\test_2024-01-15.log
```

### 2. 调试模式
在用例中添加调试信息：
```python
def test_TC_DEBUG_001(self):
    # 打印调试信息
    self.logger.info("开始执行调试测试")
    
    # 执行AW并打印结果
    result = self.call_aw("检查服务器连通性", server_ip="192.168.1.100")
    self.logger.info(f"连通性检查结果: {result}")
    
    # 添加等待时间观察
    self.sleep(2)
```

### 3. 常见问题

#### AW不存在
```
ValueError: AW 'xxx' 未注册
```
解决：检查AW名称是否正确，或联系开发人员添加AW

#### 参数错误
```
TypeError: xxx() got an unexpected keyword argument 'yyy'
```
解决：检查AW参数名称和类型是否正确

#### 连接超时
```
TimeoutError: 连接超时
```
解决：检查网络连接，或增加timeout参数

## 配置管理

### 1. 环境配置
编辑 `config/config.yaml` 文件：
```yaml
# 测试环境配置
test_environment:
  server_ip: "192.168.1.100"
  database_host: "192.168.1.101"
  web_url: "http://192.168.1.100:8080"

# 超时配置
timeouts:
  connection: 10
  http_request: 30
  database: 15
```

### 2. 在用例中使用配置
```python
from utils.config_manager import get_config

def setup(self):
    config = get_config()
    self.server_ip = config["test_environment"]["server_ip"]
    self.timeout = config["timeouts"]["connection"]
```

## 最佳实践

### 1. 用例设计原则
- 每个用例测试一个明确的功能点
- 用例之间保持独立，不相互依赖
- 使用有意义的用例名称和描述

### 2. AW使用技巧
- 优先使用现有AW，避免重复造轮子
- 参数使用变量，避免硬编码
- 合理使用验证方法，确保测试有效性

### 3. 错误处理
- 预期的失败要有明确的验证
- 意外的异常要记录详细信息
- 确保teardown方法能正常执行

### 4. 代码规范
- 使用清晰的变量名
- 添加必要的注释
- 保持代码简洁易读

## 获取帮助

### 1. 查看AW文档
```python
from framework.aw_manager import aw_manager
print(aw_manager.get_aw_doc("检查服务器连通性"))
```

### 2. 联系支持
- 框架使用问题：联系框架开发团队
- AW功能需求：提交需求给开发团队
- Bug反馈：及时反馈给相关人员

### 3. 参考资料
- `docs/AW开发规范.md` - 了解AW开发标准
- `docs/测试用例开发规范.md` - 详细的开发规范
- `testcases/TC_TEMPLATE.py` - 用例模板
- `testcases/TC_ADN_001.py` - 示例用例